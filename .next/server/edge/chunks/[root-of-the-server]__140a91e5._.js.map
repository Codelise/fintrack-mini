{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.js"],"sourcesContent":["// middleware.js (place this in your PROJECT ROOT)\nimport { NextResponse } from \"next/server\";\nimport { createServerClient } from \"@supabase/ssr\";\n\nexport async function middleware(req) {\n  console.log(\n    \"üö®üö®üö® MIDDLEWARE IS DEFINITELY RUNNING! Path:\",\n    req.nextUrl.pathname\n  );\n\n  let res = NextResponse.next();\n\n  // Create Supabase client for middleware\n  const supabase = createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,\n    {\n      cookies: {\n        getAll() {\n          return req.cookies.getAll();\n        },\n        setAll(cookiesToSet) {\n          cookiesToSet.forEach(({ name, value, options }) =>\n            req.cookies.set(name, value)\n          );\n          res = NextResponse.next({\n            request: {\n              headers: req.headers,\n            },\n          });\n          cookiesToSet.forEach(({ name, value, options }) => {\n            res.cookies.set(name, value, options);\n          });\n        },\n      },\n    }\n  );\n\n  // Refresh session if expired\n  const {\n    data: { session },\n  } = await supabase.auth.getSession();\n\n  // Define routes - USE THE PATHS FROM YOUR URL BAR\n  const protectedRoutes = [\n    \"/pages/dashboard\",\n    \"/pages/dashboard/budget\",\n    \"/pages/dashboard/goal\",\n  ];\n\n  const onboardingRoutes = [\"/pages/setBudget\", \"/pages/setGoal\"];\n\n  const publicRoutes = [\"/pages/login\", \"/pages/signUp\"];\n\n  const { pathname } = req.nextUrl;\n\n  // Check route types\n  const isProtectedRoute = protectedRoutes.some(\n    (route) => pathname === route || pathname.startsWith(route + \"/\")\n  );\n\n  const isOnboardingRoute = onboardingRoutes.some(\n    (route) => pathname === route || pathname.startsWith(route + \"/\")\n  );\n\n  const isPublicRoute = publicRoutes.some(\n    (route) => pathname === route || pathname.startsWith(route + \"/\")\n  );\n\n  console.log(\"=== MIDDLEWARE RUNNING ===\");\n  console.log(\"üìù Path:\", pathname);\n  console.log(\"üîê Session:\", !!session);\n  console.log(\"üõ°Ô∏è Protected:\", isProtectedRoute);\n  console.log(\"üéØ Onboarding:\", isOnboardingRoute);\n\n  // üîê UNAUTHENTICATED USER\n  if (!session) {\n    if (isPublicRoute) {\n      return res; // Allow login/signup\n    }\n    if (isProtectedRoute || isOnboardingRoute) {\n      console.log(\"üö´ Blocking unauthenticated user\");\n      return NextResponse.redirect(new URL(\"/pages/login\", req.url));\n    }\n  }\n\n  // üîì AUTHENTICATED USER\n  if (session) {\n    // Check onboarding status\n    const { data: userProfile } = await supabase\n      .from(\"users\")\n      .select(\"is_onboarded\")\n      .eq(\"user_id\", session.user.id)\n      .single();\n\n    const isOnboarded = userProfile?.is_onboarded || false;\n    console.log(\"üöÄ Onboarded:\", isOnboarded);\n\n    // Block onboarding routes if already onboarded\n    if (isOnboarded && isOnboardingRoute) {\n      console.log(\"üîÑ Redirecting to dashboard\");\n      return NextResponse.redirect(new URL(\"/pages/dashboard\", req.url));\n    }\n\n    // Block protected routes if not onboarded\n    if (!isOnboarded && isProtectedRoute) {\n      console.log(\"üîÑ Redirecting to setBudget\");\n      return NextResponse.redirect(new URL(\"/pages/setBudget\", req.url));\n    }\n\n    // Redirect away from login/signup if authenticated\n    if (isPublicRoute) {\n      const redirectTo = isOnboarded ? \"/pages/dashboard\" : \"/pages/setBudget\";\n      console.log(\"üîÑ Redirecting from public to:\", redirectTo);\n      return NextResponse.redirect(new URL(redirectTo, req.url));\n    }\n  }\n\n  // Root path handling\n  if (pathname === \"/\") {\n    if (session) {\n      const { data: userProfile } = await supabase\n        .from(\"users\")\n        .select(\"is_onboarded\")\n        .eq(\"user_id\", session.user.id)\n        .single();\n\n      const isOnboarded = userProfile?.is_onboarded || false;\n      return NextResponse.redirect(\n        new URL(isOnboarded ? \"/pages/dashboard\" : \"/pages/setBudget\", req.url)\n      );\n    } else {\n      return NextResponse.redirect(new URL(\"/pages/login\", req.url));\n    }\n  }\n\n  console.log(\"‚úÖ Allowing access\");\n  return res;\n}\n\nexport const config = {\n  matcher: [\"/\", \"/pages/:path*\"],\n};\n"],"names":[],"mappings":"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"}}]
}